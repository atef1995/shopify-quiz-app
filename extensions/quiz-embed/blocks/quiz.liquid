{% comment %}
  Product Quiz Block

  This block renders an interactive product recommendation quiz
  on the storefront. Customers answer questions and receive
  personalized product recommendations.
{% endcomment %}

{{ 'quiz-embed.css' | asset_url | stylesheet_tag }}

{% comment %}Display Quiz ID helper if in theme editor{% endcomment %}
{% if block.settings.quiz_id == blank %}
  <div class="quiz-setup-notice" style="padding: 20px; background: #FFF4E6; border: 2px dashed #FF6B00; border-radius: 8px; margin: 20px 0;">
    <h3 style="margin: 0 0 10px 0; color: #FF6B00;">‚ö†Ô∏è Quiz Setup Required</h3>
    <p style="margin: 0 0 10px 0;">Please enter a Quiz ID in the block settings (sidebar) to display your quiz.</p>
    <p style="margin: 0; font-size: 14px; color: #666;">
      <strong>How to find your Quiz ID:</strong><br>
      1. Go to your Shopify Apps ‚Üí Product Quiz app<br>
      2. Click on "Quizzes" in the sidebar<br>
      3. Find the quiz you want to display<br>
      4. Copy the Quiz ID and paste it in the block settings
    </p>
  </div>
{% endif %}

<div class="quiz-container" id="quiz-{{ block.id }}" 
     data-quiz-id="{{ block.settings.quiz_id }}" 
     data-primary-color="{{ block.settings.primary_color }}"
     data-secondary-color="{{ block.settings.secondary_color }}"
     data-text-color="{{ block.settings.text_color }}"
     data-background-color="{{ block.settings.background_color }}"
     data-border-radius="{{ block.settings.border_radius }}"
     data-font-family="{{ block.settings.font_family }}"
     {% if block.settings.quiz_id == blank %}style="display: none;"{% endif %}>
  <div class="quiz-wrapper">
    <!-- Loading State -->
    <div class="quiz-loading" id="quiz-loading">
      <div class="spinner"></div>
      <p>{{ 'loading.text' | t }}</p>
    </div>

    <!-- Quiz Content (populated by JavaScript) -->
    <div class="quiz-content" id="quiz-content" style="display: none;">
      <!-- Header -->
      <div class="quiz-header">
        <h2 class="quiz-title"></h2>
        <p class="quiz-description"></p>
        <div class="quiz-progress">
          <div class="quiz-progress-bar">
            <div class="quiz-progress-fill" style="width: 0%"></div>
          </div>
          <p class="quiz-progress-text">{{ 'progress.question_text' | t }} <span class="current-question">1</span> {{ 'progress.of_text' | t }} <span class="total-questions">5</span></p>
        </div>
      </div>

      <!-- Question -->
      <div class="quiz-question">
        <h3 class="question-text"></h3>
        <div class="quiz-options">
          <!-- Options populated by JS -->
        </div>
      </div>

      <!-- Navigation -->
      <div class="quiz-navigation">
        <button class="quiz-btn quiz-btn-secondary quiz-btn-back" style="display: none;">
          {{ 'navigation.back_button' | t }}
        </button>
        <button
          class="quiz-btn quiz-btn-primary quiz-btn-next"
          disabled
          data-next-text="{{ 'navigation.next_button' | t }}"
          data-results-text="{{ 'navigation.see_results_button' | t }}"
        >
          {{ 'navigation.next_button' | t }}
        </button>
      </div>
    </div>

    <!-- Email Capture -->
    <div class="quiz-email-capture" id="quiz-email-capture" style="display: none;">
      <div class="email-capture-content">
        <h2>{{ 'email_capture.heading' | t }}</h2>
        <p>{{ 'email_capture.description' | t }}</p>
        <form class="email-capture-form" id="email-capture-form">
          <input
            type="email"
            name="email"
            placeholder="{{ 'email_capture.email_placeholder' | t }}"
            required
            class="email-input"
          />
          <button type="submit" class="quiz-btn quiz-btn-primary">
            {{ 'email_capture.submit_button' | t }}
          </button>
        </form>
        <p class="email-disclaimer">{{ 'email_capture.disclaimer' | t }}</p>
      </div>
    </div>

    <!-- Results -->
    <div class="quiz-results" id="quiz-results" style="display: none;">
      <div class="results-header">
        <h2>{{ 'results.heading' | t }}</h2>
        <p>{{ 'results.description' | t }}</p>
      </div>
      <div class="results-products" id="results-products">
        <!-- Products populated by JS -->
      </div>
      <div class="results-footer">
        <button class="quiz-btn quiz-btn-secondary" onclick="location.reload()">
          {{ 'results.retake_button' | t }}
        </button>
      </div>
    </div>

    <!-- Error State -->
    <div class="quiz-error" id="quiz-error" style="display: none;">
      <p>{{ 'error.message' | t }}</p>
    </div>
  </div>
</div>

<script src="{{ 'quiz-embed.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Product Quiz",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "quiz_id",
      "label": "Quiz ID",
      "info": "Copy the Quiz ID from your app admin panel. Go to the app ‚Üí Quizzes ‚Üí Click on a quiz ‚Üí Copy the ID from the URL (the part after /quizzes/)"
    },
    {
      "type": "header",
      "content": "üé® Custom Styling (Growth Plan & Above)"
    },
    {
      "type": "color",
      "id": "primary_color",
      "label": "Primary Color",
      "default": "#667eea",
      "info": "Main brand color for buttons and highlights"
    },
    {
      "type": "color",
      "id": "secondary_color",
      "label": "Secondary Color",
      "default": "#f8f9fa",
      "info": "Background color for secondary elements"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#333333",
      "info": "Primary text color"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff",
      "info": "Quiz container background color"
    },
    {
      "type": "select",
      "id": "border_radius",
      "label": "Border Radius",
      "options": [
        { "value": "0px", "label": "Sharp" },
        { "value": "4px", "label": "Small" },
        { "value": "8px", "label": "Medium" },
        { "value": "12px", "label": "Large" },
        { "value": "16px", "label": "Extra Large" }
      ],
      "default": "8px"
    },
    {
      "type": "select",
      "id": "font_family",
      "label": "Font Family",
      "options": [
        { "value": "inherit", "label": "Inherit from theme" },
        { "value": "'Helvetica Neue', Helvetica, Arial, sans-serif", "label": "Helvetica" },
        { "value": "'Georgia', serif", "label": "Georgia" },
        { "value": "'Times New Roman', Times, serif", "label": "Times New Roman" },
        { "value": "'Courier New', monospace", "label": "Courier New" }
      ],
      "default": "inherit"
    },
    {
      "type": "paragraph",
      "content": "üí° Custom styling is available on Growth plan and above. Free plan users see default styling only."
    }
  ]
}
{% endschema %}
